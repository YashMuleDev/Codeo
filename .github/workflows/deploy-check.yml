name: Deployment Check

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  verify-deployment-config:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Verify deployment configuration
      run: node verify-deployment.js
      continue-on-error: true
    
    - name: Check required files
      run: |
        echo "Checking deployment files..."
        test -f client/package.json && echo "âœ… client/package.json" || echo "âŒ client/package.json"
        test -f server/package.json && echo "âœ… server/package.json" || echo "âŒ server/package.json"
        test -f client/vercel.json && echo "âœ… client/vercel.json" || echo "âŒ client/vercel.json"
        test -f server/render.yaml && echo "âœ… server/render.yaml" || echo "âŒ server/render.yaml"
        test -f DEPLOYMENT.md && echo "âœ… DEPLOYMENT.md" || echo "âŒ DEPLOYMENT.md"
    
    - name: Install server dependencies
      run: |
        cd server
        npm ci
    
    - name: Build server
      run: |
        cd server
        npm run build
    
    - name: Install client dependencies
      run: |
        cd client
        npm ci
    
    - name: Build client
      run: |
        cd client
        npm run build
    
    - name: Deployment ready
      run: |
        echo "âœ… All checks passed!"
        echo "ğŸš€ Ready to deploy!"
        echo ""
        echo "Next steps:"
        echo "1. Deploy backend to Render"
        echo "2. Deploy frontend to Vercel"
        echo "3. Configure environment variables"
        echo ""
        echo "See QUICK-DEPLOY.md for instructions"
